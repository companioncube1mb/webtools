<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Progress - æ™‚é–“ã®çµŒéã‚’è¦–è¦šåŒ– | å¹´ãƒ»æœˆãƒ»é€±ã®é€²æ—ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
    
    <meta name="description" content="ç¾åœ¨ã®å¹´ã€æœˆã€é€±ã€æ—¥ã®é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¦–è¦šåŒ–ã™ã‚‹ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã€‚ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™æ—¥æ™‚ã®é€²æ—ã‚‚è¿½è·¡ã§ãã¾ã™ã€‚">
    <meta name="keywords" content="æ™‚é–“ç®¡ç†, ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚«ãƒ¼, é€²æ—ãƒãƒ¼, ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼, å¹´é–“è¨ˆç”», ç›®æ¨™è¨­å®š, Time Progress">
    <meta name="author" content="Your Name">
    <meta property="og:title" content="Time Progress - æ™‚é–“ã®çµŒéã‚’è¦–è¦šåŒ–">
    <meta property="og:description" content="ç¾åœ¨ã®å¹´ã€æœˆã€é€±ã€æ—¥ã®é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¦–è¦šåŒ–ã™ã‚‹ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="YOUR_SITE_URL">
    <link rel="canonical" href="YOUR_SITE_URL">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400&display=swap');
        
        :root {
            /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
            --bg-start: #1a1a2e;
            --bg-end: #16213e;
            --text-color: white;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.1);
            --input-border: rgba(255, 255, 255, 0.2);
            --select-bg: rgba(30, 30, 50, 0.9);
            --progress-track: rgba(255, 255, 255, 0.1);
            --milestone-color: rgba(255, 255, 255, 0.2);
            --milestone-half-color: rgba(255, 255, 255, 0.3);
            --time-display-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            --datetime-local-scheme: dark;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body.light-mode {
            --bg-start: #f4f4f4;
            --bg-end: #ffffff;
            --text-color: #333;
            --card-bg: #ffffff;
            --card-border: #ddd;
            --input-bg: #f8f8f8;
            --input-border: #ccc;
            --select-bg: #f8f8f8;
            --progress-track: #e0e0e0;
            --milestone-color: rgba(0, 0, 0, 0.1);
            --milestone-half-color: rgba(0, 0, 0, 0.2);
            --time-display-shadow: none;
            --datetime-local-scheme: light;
            
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
        }
        
        /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-weight: 200;
            font-size: clamp(1.5rem, 4vw, 2rem);
        }
        
        .btn-style {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-style:hover {
            background: var(--input-border);
        }

        .current-time {
            text-align: center;
            margin-bottom: 30px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid var(--card-border);
            transition: background 0.3s, border-color 0.3s;
        }

        .time-display {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 200;
            margin-bottom: 10px;
            font-variant-numeric: tabular-nums;
            text-shadow: var(--time-display-shadow);
            transition: text-shadow 0.3s;
        }

        .date-display {
            font-size: 1.2rem;
            opacity: 0.8;
            font-weight: 300;
        }

        .progress-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--card-border);
            transition: transform 0.3s ease, background 0.3s, border-color 0.3s;
        }

        .progress-card:hover {
            transform: translateY(-2px);
        }
        
        /* ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™ã‚«ãƒ¼ãƒ‰ã®ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰èª¿æ•´ */
        .progress-card.target-card {
             background: rgba(102, 126, 234, 0.1); 
             border: 1px solid rgba(102, 126, 234, 0.3);
        }
        body.light-mode .progress-card.target-card {
             background: rgba(102, 126, 234, 0.05); 
             border: 1px solid rgba(102, 126, 234, 0.2);
        }


        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 1.2rem;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-icon {
            font-size: 1.5rem;
        }

        .progress-value {
            font-size: 1.8rem;
            font-weight: 200;
            font-variant-numeric: tabular-nums;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .progress-bar-container {
            width: 100%;
            height: 40px;
            background: var(--progress-track);
            border-radius: 0;
            overflow: hidden;
            position: relative;
            transition: background 0.3s;
        }

        .progress-bar {
            height: 100%;
            border-radius: 0;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.2), transparent);
        }
        body.light-mode .progress-bar::after {
             background: linear-gradient(180deg, rgba(255, 255, 255, 0.5), transparent);
        }

        .shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* è‰²åˆ†ã‘ */
        .progress-bar.year { background: linear-gradient(90deg, #FF6B6B, #4ECDC4); }
        .progress-bar.month { background: linear-gradient(90deg, #95E1D3, #3D5A80); }
        .progress-bar.week { background: linear-gradient(90deg, #F4A261, #E76F51); }
        .progress-bar.day { background: linear-gradient(90deg, #667eea, #764ba2); }
        .progress-bar.hour { background: linear-gradient(90deg, #56CCF2, #2F80ED); }
        .progress-bar.target { background: linear-gradient(90deg, #A8E6CF, #FFD3B6); }
        
        .progress-bar.remaining-mode {
            filter: brightness(0.9);
        }

        /* ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ */
        .milestones { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .milestone { 
            position: absolute; 
            width: 1px; 
            height: 100%; 
            background: var(--milestone-color); 
            top: 0;
            transition: background 0.3s;
        }
        .milestone.half { 
            width: 2px; 
            background: var(--milestone-half-color); 
        }
        .milestone.quarter { left: 25%; }
        .milestone.half { left: 50%; }
        .milestone.three-quarter { left: 75%; }

        /* çµ±è¨ˆæƒ…å ± */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--card-border);
            transition: background 0.3s, border-color 0.3s;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .form-input {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 8px;
            border-radius: 10px;
            flex: 1;
            min-width: 200px;
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }
        
        input[type="datetime-local"] {
            color-scheme: var(--datetime-local-scheme); 
        }
        
        /* Selectãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #weekStartDay {
            background: var(--select-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 10px;
            margin-left: 10px;
            cursor: pointer;
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }
        
        #weekStartDay option {
             background: var(--select-bg); /* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èƒŒæ™¯ã‚‚ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã‚‹ */
        }

        .form-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        body.light-mode .form-button {
            background: linear-gradient(135deg, #4c68d7, #694ba2);
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ– */
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .header-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="title">ğŸ“Š æ™‚é–“ã®çµŒé</h1>
            <div class="header-buttons">
                <button class="btn-style" id="langBtn">ğŸŒ English</button>
                <button class="btn-style" id="themeBtn">ğŸŒ™ Dark</button>
            </div>
        </div>
        
        <div class="current-time" style="margin-bottom: 20px;">
            <div style="display: flex; gap: 20px; align-items: center; justify-content: center; flex-wrap: wrap;">
                <div>
                    <label for="weekStartDay" style="font-size: 0.9rem; opacity: 0.8;" id="weekStartLabel">é€±ã®é–‹å§‹æ›œæ—¥:</label>
                    <select id="weekStartDay">
                        <option value="1">æœˆæ›œæ—¥</option>
                        <option value="0">æ—¥æ›œæ—¥</option>
                        <option value="6">åœŸæ›œæ—¥</option>
                    </select>
                </div>
                <div>
                    <button class="btn-style" id="togglePercentMode">çµŒé % / æ®‹ã‚Š %</button>
                </div>
            </div>
        </div>
        
        <div class="current-time">
            <div class="time-display" id="currentTime">--:--:--</div>
            <div class="date-display" id="currentDate">----å¹´--æœˆ--æ—¥</div>
        </div>
        
        <div class="progress-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">ğŸ“…</span>
                    <span id="yearTitle">ä»Šå¹´</span>
                </div>
                <div class="progress-value" id="yearPercent">--%</div>
            </div>
            <div class="progress-details">
                <span id="yearStart">1æœˆ1æ—¥ã‹ã‚‰</span>
                <span id="yearProgress">---æ—¥çµŒé</span>
                <span id="yearRemaining">æ®‹ã‚Š---æ—¥</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar year" id="yearBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">ğŸ—“ï¸</span>
                    <span id="monthTitle">ä»Šæœˆ</span>
                </div>
                <div class="progress-value" id="monthPercent">--%</div>
            </div>
            <div class="progress-details">
                <span id="monthStart">-æœˆ1æ—¥ã‹ã‚‰</span>
                <span id="monthProgress">--æ—¥çµŒé</span>
                <span id="monthRemaining">æ®‹ã‚Š--æ—¥</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar month" id="monthBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">ğŸ“†</span>
                    <span id="weekTitle">ä»Šé€±</span>
                </div>
                <div class="progress-value" id="weekPercent">--%</div>
            </div>
            <div class="progress-details">
                <span id="weekStart">æœˆæ›œã‹ã‚‰</span>
                <span id="weekProgress">--æ—¥çµŒé</span>
                <span id="weekRemaining">æ®‹ã‚Š--æ—¥</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar week" id="weekBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">â˜€ï¸</span>
                    <span id="dayTitle">ä»Šæ—¥</span>
                </div>
                <div class="progress-value" id="dayPercent">--%</div>
            </div>
            <div class="progress-details">
                <span id="dayStart">0:00ã‹ã‚‰</span>
                <span id="dayProgress">--æ™‚é–“çµŒé</span>
                <span id="dayRemaining">æ®‹ã‚Š--æ™‚é–“</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar day" id="dayBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">â°</span>
                    <span id="hourTitle">ç¾åœ¨ã®æ™‚é–“</span>
                </div>
                <div class="progress-value" id="hourPercent">--%</div>
            </div>
            <div class="progress-details">
                <span id="hourStart">--:00ã‹ã‚‰</span>
                <span id="hourProgress">--åˆ†çµŒé</span>
                <span id="hourRemaining">æ®‹ã‚Š--åˆ†</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar hour" id="hourBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-card target-card">
            <div class="progress-header">
                <div class="progress-title">
                    <span class="progress-icon">ğŸ¯</span>
                    <span id="targetTitle">ç›®æ¨™æ—¥æ™‚</span>
                </div>
                <div class="progress-value" id="targetPercent">--%</div>
            </div>
            <div class="progress-details" style="margin-bottom: 15px;">
                <span id="targetStart">é–‹å§‹æ—¥æ™‚</span>
                <span id="targetProgress">--çµŒé</span>
                <span id="targetRemaining">æ®‹ã‚Š--</span>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 20px;">
                <input type="datetime-local" id="targetStartDateInput" class="form-input">
                <span style="opacity: 0.8;">â†’</span>
                <input type="datetime-local" id="targetEndDateInput" class="form-input">
                <button id="setTargetBtn" class="form-button">è¨­å®š</button>
            </div>
            
            <div class="progress-bar-container" id="targetContainer" style="display: none; margin-top: 15px;">
                <div class="progress-bar target" id="targetBar" style="width: 0%">
                    <div class="shine"></div>
                </div>
                <div class="milestones">
                    <div class="milestone quarter"></div>
                    <div class="milestone half"></div>
                    <div class="milestone three-quarter"></div>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="yearDay">---</div>
                <div class="stat-label" id="yearDayLabel">ä»Šå¹´ã®æ—¥æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="weekNumber">--</div>
                <div class="stat-label" id="weekNumberLabel">ä»Šå¹´ã®é€±ç•ªå·</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="dayOfWeek">--</div>
                <div class="stat-label" id="dayOfWeekLabel">æ›œæ—¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalMinutes">----</div>
                <div class="stat-label" id="totalMinutesLabel">ä»Šæ—¥ã®çµŒéåˆ†æ•°</div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
            <script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi', '#72a4f2', 'L4L61PTJ5F');kofiwidget2.draw();</script>
        </div>
    </div>

    <script>
        // è¨€èªè¨­å®š
        const translations = {
            ja: {
                title: 'ğŸ“Š æ™‚é–“ã®çµŒé',
                year: 'ä»Šå¹´',
                month: 'ä»Šæœˆ',
                week: 'ä»Šé€±', 
                day: 'ä»Šæ—¥',
                hour: 'ç¾åœ¨ã®æ™‚é–“',
                target: 'ç›®æ¨™æ—¥æ™‚',
                fromJan: '1æœˆ1æ—¥ã‹ã‚‰',
                fromMonthStart: 'æœˆ1æ—¥ã‹ã‚‰',
                fromMonday: 'æœˆæ›œã‹ã‚‰',
                fromSunday: 'æ—¥æ›œã‹ã‚‰',
                fromSaturday: 'åœŸæ›œã‹ã‚‰',
                fromMidnight: '0:00ã‹ã‚‰',
                fromHourStart: ':00ã‹ã‚‰',
                // â­ ä¿®æ­£2: æ—¥æœ¬èªã®æ®‹ã‚Šæ™‚é–“è¡¨ç¾ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã€å˜ä½ã¨æ¥é ­è¾ã‚’åˆ†ã‘ã‚‹
                elapsed: 'çµŒé',
                remaining: 'æ®‹ã‚Š',
                dayUnit: 'æ—¥',
                hourUnit: 'æ™‚é–“',
                minuteUnit: 'åˆ†',
                // æ—¢å­˜ã®Elapsedã¯ãã®ã¾ã¾ä½¿ç”¨
                daysElapsed: 'æ—¥çµŒé',
                hoursElapsed: 'æ™‚é–“çµŒé',
                minutesElapsed: 'åˆ†çµŒé',
                
                dayOfYear: 'ä»Šå¹´ã®æ—¥æ•°',
                weekOfYear: 'ä»Šå¹´ã®é€±ç•ªå·',
                dayOfWeek: 'æ›œæ—¥',
                minutesToday: 'ä»Šæ—¥ã®çµŒéåˆ†æ•°',
                weekdays: ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'],
                months: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'],
                weekStartLabel: 'é€±ã®é–‹å§‹æ›œæ—¥:',
                monday: 'æœˆæ›œæ—¥',
                sunday: 'æ—¥æ›œæ—¥',
                saturday: 'åœŸæ›œæ—¥',
                setTarget: 'è¨­å®š',
                targetNotSet: 'ç›®æ¨™ã‚’è¨­å®šã—ã¦ãã ã•ã„',
                completed: 'å®Œäº†',
                invalidRange: 'âš ï¸ ç„¡åŠ¹ãªæœŸé–“',
                toggleElapsed: 'çµŒé %',
                toggleRemaining: 'æ®‹ã‚Š %'
            },
            en: {
                title: 'ğŸ“Š Time Progress',
                year: 'This Year',
                month: 'This Month',
                week: 'This Week',
                day: 'Today',
                hour: 'Current Hour',
                target: 'Target Date',
                fromJan: 'From Jan 1',
                fromMonthStart: 'From 1st',
                fromMonday: 'From Monday',
                fromSunday: 'From Sunday', 
                fromSaturday: 'From Saturday',
                fromMidnight: 'From 0:00',
                fromHourStart: ':00',
                daysElapsed: 'days elapsed',
                hoursElapsed: 'hours elapsed',
                minutesElapsed: 'min elapsed',
                
                elapsed: 'elapsed',
                remaining: 'remaining',
                dayUnit: 'days',
                hourUnit: 'hours',
                minuteUnit: 'min',

                dayOfYear: 'Day of Year',
                weekOfYear: 'Week Number',
                dayOfWeek: 'Day of Week',
                minutesToday: "Today's Minutes",
                weekdays: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                months: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                weekStartLabel: 'Week starts on:',
                monday: 'Monday',
                sunday: 'Sunday',
                saturday: 'Saturday',
                setTarget: 'Set',
                targetNotSet: 'Set your target date',
                completed: 'Completed',
                invalidRange: 'âš ï¸ Invalid Range',
                toggleElapsed: 'Elapsed %',
                toggleRemaining: 'Remaining %'
            }
        };
        
        // çŠ¶æ…‹å¤‰æ•°
        let currentLang = 'ja';
        let weekStartDay = 1; 
        let targetStartDate = null;
        let targetEndDate = null;
        let isElapsedMode = true; 
        let currentTheme = 'dark'; // 'dark' or 'light'
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°: æ®‹ã‚Šæ™‚é–“ã®è¡¨ç¤ºã‚’ä¿®æ­£ã•ã‚ŒãŸæ—¥æœ¬èªã§å‡ºåŠ›
        function getRemainingText(count, unitKey) {
            const t = translations[currentLang];
            const unit = t[unitKey];
            
            if (currentLang === 'ja') {
                return `${t.remaining} ${count} ${unit}`; // ä¾‹: æ®‹ã‚Š 3 æ—¥
            } else {
                return `${count} ${unit} ${t.remaining}`; // ä¾‹: 3 days remaining
            }
        }
        
        // â­ ä¿®æ­£1: ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹é–¢æ•°
        function setTheme(theme, save = true) {
            currentTheme = theme;
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeBtn').textContent = 'ğŸŒ™ Dark';
            } else {
                document.body.classList.remove('light-mode');
                document.getElementById('themeBtn').textContent = 'â˜€ï¸ Light';
            }
            // datetime-local ã®ãƒ†ãƒ¼ãƒã‚’ç¢ºå®Ÿã«é©ç”¨
            document.body.style.colorScheme = theme;
            
            if (save) saveSettings(false); 
        }
        
        function loadSettings() {
            const params = new URLSearchParams(window.location.search);
            
            // è¨€èªè¨­å®š
            const urlLang = params.get('lang');
            const localLang = localStorage.getItem('lang');
            if (urlLang && translations[urlLang]) {
                currentLang = urlLang;
            } else if (localLang && translations[localLang]) {
                currentLang = localLang;
            }
            
            // é€±ã®é–‹å§‹æ›œæ—¥
            const urlWeekStart = params.get('weekStart');
            const localWeekStart = localStorage.getItem('weekStart');
            if (urlWeekStart !== null && ['0', '1', '6'].includes(urlWeekStart)) {
                weekStartDay = parseInt(urlWeekStart);
            } else if (localWeekStart !== null && ['0', '1', '6'].includes(localWeekStart)) {
                weekStartDay = parseInt(localWeekStart);
            }
            document.getElementById('weekStartDay').value = weekStartDay.toString();
            
            // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰
            const localPercentMode = localStorage.getItem('isElapsedMode');
            if (localPercentMode !== null) {
                isElapsedMode = localPercentMode === 'true';
            }
            
            // â­ ä¿®æ­£1: ãƒ†ãƒ¼ãƒè¨­å®šã®ãƒ­ãƒ¼ãƒ‰ (Local Storage > prefers-color-scheme > Default)
            const localTheme = localStorage.getItem('theme');
            if (localTheme && ['dark', 'light'].includes(localTheme)) {
                currentTheme = localTheme;
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                currentTheme = 'light';
            } else {
                currentTheme = 'dark';
            }
            setTheme(currentTheme, false);
        }
        
        function saveSettings(updateUrl = true) {
            // LocalStorageä¿å­˜
            localStorage.setItem('lang', currentLang);
            localStorage.setItem('weekStart', weekStartDay.toString());
            localStorage.setItem('isElapsedMode', isElapsedMode.toString());
            localStorage.setItem('theme', currentTheme); // â­ ä¿®æ­£1: ãƒ†ãƒ¼ãƒã‚’ä¿å­˜
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°
            if (updateUrl) {
                const url = new URL(window.location.href);
                url.searchParams.set('lang', currentLang);
                url.searchParams.set('weekStart', weekStartDay.toString());
                window.history.replaceState({}, '', url.toString());
            }
        }
        
        function updateLanguage() {
            const t = translations[currentLang];
            document.getElementById('title').textContent = t.title;
            document.getElementById('targetTitle').textContent = t.target;
            document.getElementById('yearDayLabel').textContent = t.dayOfYear;
            document.getElementById('weekNumberLabel').textContent = t.weekOfYear;
            document.getElementById('dayOfWeekLabel').textContent = t.dayOfWeek;
            document.getElementById('totalMinutesLabel').textContent = t.minutesToday;
            document.getElementById('weekStartLabel').textContent = t.weekStartLabel;
            document.getElementById('setTargetBtn').textContent = t.setTarget;
            document.getElementById('langBtn').textContent = currentLang === 'ja' ? 'ğŸŒ English' : 'ğŸŒ æ—¥æœ¬èª';
            
            const weekStartSelect = document.getElementById('weekStartDay');
            weekStartSelect.options[0].text = t.monday;
            weekStartSelect.options[1].text = t.sunday;
            weekStartSelect.options[2].text = t.saturday;
            
            document.documentElement.lang = currentLang;
            
            document.getElementById('togglePercentMode').textContent = isElapsedMode 
                ? `${t.toggleElapsed} / ${t.toggleRemaining}` 
                : `${t.toggleRemaining} / ${t.toggleElapsed}`;
        }

        // å¹´é–“ã®çµŒéæ—¥æ•°ã‚’å–å¾—
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }
        
        // ã‚«ã‚¹ã‚¿ãƒ é€±ç•ªå·ã‚’è¨ˆç®— (éISO)
        function getCustomWeekNumber(date, weekStart) {
            const startOfYear = new Date(date.getFullYear(), 0, 1);
            const dayOfYear = getDayOfYear(date);
            const jan1DayOfWeek = startOfYear.getDay();
            const offset = (jan1DayOfWeek - weekStart + 7) % 7;
            return Math.ceil((dayOfYear + offset) / 7);
        }
        
        function formatTimeRemaining(milliseconds) {
            const t = translations[currentLang];
            const totalSeconds = Math.floor(milliseconds / 1000);
            const totalDays = Math.floor(totalSeconds / (60 * 60 * 24));
            const hours = Math.floor((totalSeconds % (60 * 60 * 24)) / (60 * 60));
            const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
            
            if (totalDays > 0) {
                // ä¾‹: 3æ—¥ 10æ™‚é–“
                return `${totalDays}${t.dayUnit} ${hours}${t.hourUnit}`;
            } else if (hours > 0) {
                // ä¾‹: 10æ™‚é–“ 30åˆ†
                return `${hours}${t.hourUnit} ${minutes}${t.minuteUnit}`;
            } else {
                // ä¾‹: 30åˆ†
                return `${minutes}${t.minuteUnit}`;
            }
        }
        
        // æ¯ç§’æ›´æ–°ã™ã‚‹å‡¦ç†
        function updateClock() {
            const now = new Date();
            const t = translations[currentLang];
            const year = now.getFullYear();
            const month = now.getMonth();
            const date = now.getDate();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const weekday = now.getDay();
            
            // 1. ç¾åœ¨æ™‚åˆ»ã®è¡¨ç¤º
            const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('currentTime').textContent = timeStr;
            
            if (currentLang === 'ja') {
                document.getElementById('currentDate').textContent = 
                    `${year}å¹´${month + 1}æœˆ${date}æ—¥ï¼ˆ${t.weekdays[weekday]}ï¼‰`;
            } else {
                document.getElementById('currentDate').textContent = 
                    `${t.months[month]} ${date}, ${year} (${t.weekdays[weekday]})`;
            }

            // 2. æ™‚é–“ã®é€²æ— (Hour Progress)
            const hourStart = new Date(year, month, date, hours, 0, 0);
            const hourEnd = new Date(year, month, date, hours + 1, 0, 0);
            const hourTotal = hourEnd - hourStart;
            const hourElapsed = now - hourStart;
            const hourPercent = Math.min(100, Math.max(0, (hourElapsed / hourTotal) * 100));
            const minutesElapsed = Math.floor(hourElapsed / (1000 * 60));
            const minutesRemaining = 60 - minutesElapsed;

            const displayPercent = isElapsedMode ? hourPercent : 100 - hourPercent;
            const percentStr = `${Math.floor(displayPercent)}%`;
            
            document.getElementById('hourTitle').textContent = t.hour;
            document.getElementById('hourPercent').textContent = percentStr;
            document.getElementById('hourBar').style.width = `${isElapsedMode ? hourPercent : 100 - hourPercent}%`;
            document.getElementById('hourBar').classList.toggle('remaining-mode', !isElapsedMode);

            document.getElementById('hourStart').textContent = `${hours}${t.fromHourStart}`;
            document.getElementById('hourProgress').textContent = `${minutesElapsed} ${t.minutesElapsed}`;
            
            // â­ ä¿®æ­£2: æ—¥æœ¬èªè¡¨ç¾ã®ä¿®æ­£
            document.getElementById('hourRemaining').textContent = getRemainingText(minutesRemaining, 'minuteUnit');
            
            // 3. çµ±è¨ˆæƒ…å ± (Minutes Today)
            document.getElementById('totalMinutes').textContent = hours * 60 + minutes + Math.floor(seconds / 60);
        }

        // æ¯åˆ†æ›´æ–°ã™ã‚‹å‡¦ç†
        function updateProgress() {
            const now = new Date();
            const t = translations[currentLang];
            const year = now.getFullYear();
            const month = now.getMonth();
            const date = now.getDate();
            const weekday = now.getDay();

            // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°: é€²æ—ã‚’æ›´æ–°ã—DOMã«åæ˜ ã™ã‚‹
            const updateCard = (id, elapsed, total, titleKey, elapsedDetail, remainingCount, unitKey) => {
                const percent = Math.min(100, Math.max(0, Math.floor((elapsed / total) * 100)));
                
                const displayPercent = isElapsedMode ? percent : 100 - percent;
                const percentStr = `${displayPercent}%`;
                const barWidth = isElapsedMode ? percent : 100 - percent;
                
                document.getElementById(`${id}Title`).textContent = t[titleKey];
                document.getElementById(`${id}Percent`).textContent = percentStr;
                document.getElementById(`${id}Bar`).style.width = `${barWidth}%`;
                document.getElementById(`${id}Bar`).classList.toggle('remaining-mode', !isElapsedMode);
                
                document.getElementById(`${id}Progress`).textContent = elapsedDetail;
                
                // â­ ä¿®æ­£2: æ—¥æœ¬èªè¡¨ç¾ã®ä¿®æ­£
                document.getElementById(`${id}Remaining`).textContent = getRemainingText(remainingCount, unitKey);
            };

            // --- å¹´ã®é€²æ— ---
            const yearStart = new Date(year, 0, 1);
            const yearEnd = new Date(year + 1, 0, 1);
            const yearTotal = yearEnd - yearStart;
            const yearElapsed = now - yearStart;
            const daysInYear = getDayOfYear(now);
            const daysRemainingInYear = Math.ceil((yearEnd - now) / (1000 * 60 * 60 * 24)); 
            
            updateCard('year', yearElapsed, yearTotal, 'year',
                `${daysInYear} ${t.daysElapsed}`,
                daysRemainingInYear, 'dayUnit');
            document.getElementById('yearStart').textContent = t.fromJan;

            // --- æœˆã®é€²æ— ---
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 1);
            const monthTotal = monthEnd - monthStart;
            const monthElapsed = now - monthStart;
            const daysRemainingInMonth = Math.max(
                0,
                Math.ceil((monthEnd - now) / (1000 * 60 * 60 * 24))
            );
            
            updateCard('month', monthElapsed, monthTotal, 'month',
                `${date} ${t.daysElapsed}`,
                daysRemainingInMonth, 'dayUnit');
            document.getElementById('monthStart').textContent = currentLang === 'ja' ? 
                `${month + 1}${t.fromMonthStart}` : `${t.months[month]} ${t.fromMonthStart}`;

            // --- é€±ã®é€²æ—ï¼ˆã‚«ã‚¹ã‚¿ãƒ é–‹å§‹æ›œæ—¥ï¼‰---
            weekStartDay = parseInt(document.getElementById('weekStartDay').value);
            const currentDayOfWeek = weekday;
            let daysFromWeekStart;
            
            if (weekStartDay === 0) { daysFromWeekStart = currentDayOfWeek; } 
            else if (weekStartDay === 1) { daysFromWeekStart = currentDayOfWeek === 0 ? 6 : currentDayOfWeek - 1; } 
            else if (weekStartDay === 6) { daysFromWeekStart = (currentDayOfWeek + 1) % 7; }
            
            const weekStart = new Date(now);
            weekStart.setDate(date - daysFromWeekStart);
            weekStart.setHours(0, 0, 0, 0);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 7);
            const weekTotal = weekEnd - weekStart;
            const weekElapsed = now - weekStart;
            const daysElapsedInWeek = Math.floor(weekElapsed / (1000 * 60 * 60 * 24));
            
            const daysRemainingInWeek = Math.max(
                0,
                Math.ceil((weekEnd - now) / (1000 * 60 * 60 * 24))
            );
            
            updateCard('week', weekElapsed, weekTotal, 'week',
                `${daysElapsedInWeek} ${t.daysElapsed}`,
                daysRemainingInWeek, 'dayUnit');
            
            if (weekStartDay === 0) { document.getElementById('weekStart').textContent = t.fromSunday; } 
            else if (weekStartDay === 1) { document.getElementById('weekStart').textContent = t.fromMonday; } 
            else if (weekStartDay === 6) { document.getElementById('weekStart').textContent = t.fromSaturday; }
            
            // --- æ—¥ã®é€²æ— ---
            const dayStart = new Date(year, month, date, 0, 0, 0);
            const dayEnd = new Date(year, month, date + 1, 0, 0, 0);
            const dayTotal = dayEnd - dayStart;
            const dayElapsed = now - dayStart;
            const hoursElapsed = Math.floor(dayElapsed / (1000 * 60 * 60));
            const hoursRemaining = Math.ceil((dayEnd - now) / (1000 * 60 * 60));
            
            updateCard('day', dayElapsed, dayTotal, 'day',
                `${hoursElapsed} ${t.hoursElapsed}`,
                hoursRemaining, 'hourUnit');
            document.getElementById('dayTitle').textContent = t.day;
            document.getElementById('dayStart').textContent = t.fromMidnight;
            
            // --- ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™æ—¥æ™‚ã®é€²æ— ---
            if (targetStartDate && targetEndDate) {
                const targetTotal = targetEndDate - targetStartDate;
                const targetElapsed = now - targetStartDate;
                
                if (targetTotal <= 0) {
                    document.getElementById('targetContainer').style.display = 'none';
                    document.getElementById('targetStart').textContent = t.invalidRange;
                    document.getElementById('targetPercent').textContent = '--%';
                    document.getElementById('targetProgress').textContent = '';
                    document.getElementById('targetRemaining').textContent = '';
                    return;
                }
                
                const targetPercent = Math.min(100, Math.max(0, Math.floor((targetElapsed / targetTotal) * 100)));
                const targetRemaining = targetEndDate - now;
                
                document.getElementById('targetContainer').style.display = 'block';
                
                const displayPercent = isElapsedMode ? targetPercent : 100 - targetPercent;
                const barWidth = isElapsedMode ? targetPercent : 100 - targetPercent;
                document.getElementById('targetPercent').textContent = `${displayPercent}%`;
                document.getElementById('targetBar').style.width = `${barWidth}%`;
                document.getElementById('targetBar').classList.toggle('remaining-mode', !isElapsedMode);

                const startStr = `${targetStartDate.getMonth() + 1}/${targetStartDate.getDate()} ${targetStartDate.getHours().toString().padStart(2, '0')}:${targetStartDate.getMinutes().toString().padStart(2, '0')}`;
                document.getElementById('targetStart').textContent = `ğŸ¯ ${startStr} â†’`;
                
                if (targetPercent >= 100) {
                    document.getElementById('targetProgress').textContent = t.elapsed;
                    document.getElementById('targetRemaining').textContent = t.completed;
                    document.getElementById('targetBar').style.background = 'linear-gradient(90deg, #4ECDC4, #A8E6CF)';
                } else if (targetPercent <= 0 && targetElapsed < 0) {
                     const remainingTime = targetStartDate - now;
                     document.getElementById('targetProgress').textContent = `${t.remaining} ${formatTimeRemaining(remainingTime)}`;
                     document.getElementById('targetRemaining').textContent = t.elapsed;
                     document.getElementById('targetBar').style.background = 'linear-gradient(90deg, #F4A261, #FFD3B6)';
                     document.getElementById('targetBar').style.width = '0%';
                } else {
                    const elapsedDays = Math.floor(targetElapsed / (1000 * 60 * 60 * 24));
                    document.getElementById('targetProgress').textContent = `${elapsedDays}${t.dayUnit} ${t.elapsed}`;
                    document.getElementById('targetRemaining').textContent = `${t.remaining} ${formatTimeRemaining(targetRemaining)}`;
                    document.getElementById('targetBar').style.background = 'linear-gradient(90deg, #A8E6CF, #FFD3B6)';
                }
            } else {
                document.getElementById('targetContainer').style.display = 'none';
                document.getElementById('targetStart').textContent = t.targetNotSet;
                document.getElementById('targetPercent').textContent = '--%';
                document.getElementById('targetProgress').textContent = '';
                document.getElementById('targetRemaining').textContent = '';
            }
            
            // --- çµ±è¨ˆæƒ…å ± ---
            const daysInCurrentYear = new Date(year, 11, 31) - yearStart;
            document.getElementById('yearDay').textContent = `${daysInYear}/${Math.ceil(daysInCurrentYear / (1000 * 60 * 60 * 24))}`;
            document.getElementById('weekNumber').textContent = getCustomWeekNumber(now, weekStartDay);
            document.getElementById('dayOfWeek').textContent = t.weekdays[weekday];
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('langBtn').addEventListener('click', () => {
            currentLang = currentLang === 'ja' ? 'en' : 'ja';
            saveSettings(); 
            updateLanguage();
            updateProgress(); 
        });
        
        // â­ ä¿®æ­£1: ãƒ†ãƒ¼ãƒãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('themeBtn').addEventListener('click', () => {
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            updateClock();
            updateProgress();
        });
        
        document.getElementById('weekStartDay').addEventListener('change', (e) => {
            weekStartDay = parseInt(e.target.value);
            saveSettings();
            updateProgress();
        });

        document.getElementById('togglePercentMode').addEventListener('click', () => {
            isElapsedMode = !isElapsedMode;
            saveSettings(false); 
            updateLanguage();
            updateClock(); 
            updateProgress();
        });
        
        document.getElementById('setTargetBtn').addEventListener('click', () => {
            const startInput = document.getElementById('targetStartDateInput').value;
            const endInput = document.getElementById('targetEndDateInput').value;
            
            if (startInput && endInput) {
                targetStartDate = new Date(startInput);
                targetEndDate = new Date(endInput);
                
                localStorage.setItem('targetStartDate', startInput);
                localStorage.setItem('targetEndDate', endInput);
                
                updateProgress();
            }
        });
        
        // æ—¥æ™‚å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
        const formatDateForInput = (date) => {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        };
        
        // åˆæœŸåŒ–å‡¦ç†
        (function initialize() {
            // 1. è¨­å®šã®ãƒ­ãƒ¼ãƒ‰ (ãƒ†ãƒ¼ãƒã‚’å«ã‚€)
            loadSettings();
            
            // 2. ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™ã®LocalStorageã‹ã‚‰ã®å¾©å…ƒ
            const savedStart = localStorage.getItem('targetStartDate');
            const savedEnd = localStorage.getItem('targetEndDate');
            
            // 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¾ãŸã¯å¾©å…ƒå€¤ã‚’ã‚»ãƒƒãƒˆ
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('targetStartDateInput').value = savedStart || formatDateForInput(now);
            document.getElementById('targetEndDateInput').value = savedEnd || formatDateForInput(tomorrow);
            
            if (savedStart && savedEnd) {
                targetStartDate = new Date(savedStart);
                targetEndDate = new Date(savedEnd);
            }
            
            // 4. è¨€èªã¨é€²æ—ã®åˆå›æ›´æ–°
            updateLanguage();
            updateClock(); 
            updateProgress(); 
            
            // 5. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«è¨­å®š
            setInterval(updateClock, 1000); 
            setInterval(updateProgress, 60000); 
        })();
    </script>
</body>
</html>
